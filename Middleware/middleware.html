<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Middleware ka Funda - Fullstackgada Interactive Demo</title>
    <link rel="icon" type="image/png" href="/image/favicon.ico">
    <link rel="stylesheet" href="/interactive-demo.css">
</head>
<body>
    <div class="container">
        <div class="header-interactive" style="position:relative;">
        <h1>Middleware ka Funda</h1>
        <p>Understand how Middleware works with Fullstackgada</p>
       <div class="explore-diagrams-btn-wrapper">
            <a href="/interactive.html" class="explore-diagrams-btn">
                <img src="/image/plus-circle.svg" alt="Instagram icon"> More Diagrams
            </a>
        </div>
       <div class="follow-btn-wrapper">
            <a href="https://www.instagram.com/fullstackgada" target="_blank" class="follow-btn">
    <img src="/image/instagram.svg" alt="Instagram icon"> Follow for More
</a>
        </div>
    </div>

        <!-- Demo Grid -->
        <div class="demo-grid">
            <!-- Middleware Concept Explanation -->
            <div class="demo-section">
                <h2 class="demo-title">ğŸšª Middleware Kya Hai?</h2>
                
                <div class="explanation">
                    <strong>Middleware:</strong> Functions jo request aur response ke beech mein kaam karte hain - bilkul society ke checkpoints jaise!
                </div>

                <!-- Society Gate Analogy -->
                <div class="saree-analogy">
                    <h4>ğŸ¢ Society Gate Checkpoint System</h4>
                    <div class="saree-step">
                        <div class="saree-emoji">ğŸ‘®</div>
                        <div><strong>Watchman:</strong> Kahan ja rahe ho? (Request Validation)</div>
                    </div>
                    <div class="saree-step">
                        <div class="saree-emoji">ğŸ”</div>
                        <div><strong>Security Guard:</strong> Bag check karta hai (Authentication)</div>
                    </div>
                    <div class="saree-step">
                        <div class="saree-emoji">ğŸ“</div>
                        <div><strong>Log Book:</strong> Entry note karta hai (Logging)</div>
                    </div>
                    <div class="saree-step">
                        <div class="saree-emoji">ğŸšª</div>
                        <div><strong>Aakhir Mein:</strong> Babita ji bahar ja sakti hain (API Response)</div>
                    </div>
                </div>

                <!-- Middleware Demo Controls -->
                <div class="demo-controls">
                    <button class="demo-btn first-btn" onclick="demonstrateMiddlewareFlow()">
                        ğŸšª Poora Middleware Flow
                    </button>
                    <button class="demo-btn" onclick="demonstrateMiddlewareReject()">
                        ğŸš« Middleware Rejection
                    </button>
                    <button class="demo-btn" onclick="demonstrateMiddlewareReuse()">
                        â™»ï¸ Middleware Reusability
                    </button>
                    <button class="demo-btn clear-btn" onclick="clearMiddlewareDemo()">
                        ğŸ—‘ï¸ Clear Karo
                    </button>
                </div>

                <!-- Demo Results -->
                <div class="demo-area" id="middlewareResults">
                    <div class="event-message one-message">
                        Upar ke buttons dabao Middleware ka action dekhne ke liye!
                    </div>
                </div>
            </div>

            <!-- Live API Request Simulator -->
            <div class="demo-section">
                <h2 class="demo-title">ğŸŒ Live API Request Flow</h2>
                
                <div class="explanation one-explanation">
                    <strong>Simulate Karo:</strong> Asli API request ke saath middleware pipeline dekho!
                </div>

                <!-- Request Configuration -->
                <div class="form-group">
                    <label>API Endpoint:</label>
                    <select id="apiEndpoint">
                        <option value="/user/profile">GET /user/profile</option>
                        <option value="/user/update">POST /user/update</option>
                        <option value="/admin/dashboard">GET /admin/dashboard</option>
                        <option value="/public/news">GET /public/news</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Authorization Token:</label>
                    <input type="text" id="authToken" placeholder="Token daalo (try: valid-token, expired-token, ya khali)" value="valid-token">
                </div>

                <div class="form-group">
                    <label>User Role:</label>
                    <select id="userRole">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                        <option value="guest">Guest</option>
                    </select>
                </div>

                <!-- Send Request Button -->
                <button class="demo-btn first-btn" onclick="sendAPIRequest()" id="sendRequestBtn">
                    ğŸš€ API Request Bhejo
                </button>

                <!-- Middleware Pipeline Display -->
                <div class="how-it-works" id="middlewarePipeline">
                    <h4>ğŸ”„ Middleware Pipeline:</h4>
                    <div class="step">
                        <div class="step-number">1</div>
                        <div>Request Logger - Aane wali requests ko log karta hai</div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div>Auth Middleware - Token check karta hai</div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div>Role Checker - User ke permissions dekhta hai</div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div>Rate Limiter - Requests ki speed control karta hai</div>
                    </div>
                    <div class="step">
                        <div class="step-number">5</div>
                        <div>Main API Handler - Business logic chalata hai</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Pipeline Visualization -->
        <div class="demo-section" style="grid-column: 1 / -1;">
            <h2 class="demo-title">ğŸ¬ Real-time Middleware Execution</h2>
            
            <div class="explanation">
                <strong>Live Tracking:</strong> Request ke saath-saath har middleware ka execution dekho!
            </div>

            <!-- Pipeline Visualization -->
            <div class="memory-diagram" id="pipelineVisualization">
                <div class="memory-slot" id="step1-logger">
                    <div class="variable-name">1ï¸âƒ£ Request Logger</div>
                    <div class="variable-value">Request ka intezaar...</div>
                </div>
                <div class="memory-slot" id="step2-auth">
                    <div class="variable-name">2ï¸âƒ£ Authentication</div>
                    <div class="variable-value">Intezaar...</div>
                </div>
                <div class="memory-slot" id="step3-role">
                    <div class="variable-name">3ï¸âƒ£ Role Authorization</div>
                    <div class="variable-value">Intezaar...</div>
                </div>
                <div class="memory-slot" id="step4-rate">
                    <div class="variable-name">4ï¸âƒ£ Rate Limiting</div>
                    <div class="variable-value">Intezaar...</div>
                </div>
                <div class="memory-slot" id="step5-api">
                    <div class="variable-name">5ï¸âƒ£ API Handler</div>
                    <div class="variable-value">Intezaar...</div>
                </div>
                <div class="memory-slot" id="step6-response">
                    <div class="variable-name">6ï¸âƒ£ Response</div>
                    <div class="variable-value">Intezaar...</div>
                </div>
            </div>

            <!-- Execution Log -->
            <div class="server-simulation">
                <h4>Execution Log:</h4>
                <div class="server-log" id="executionLog">
                    Middleware execution track karne ke liye tayyar...
                </div>
            </div>
        </div>

        <!-- Code Examples Section -->
        <div class="demo-section" style="grid-column: 1 / -1;">
            <h2 class="demo-title">ğŸ’» Middleware Code ke Examples</h2>
            
            <div class="tabs">
                <button class="tab active" onclick="showMiddlewareExample('express-basic')">ğŸš€ Express.js Basic</button>
                <button class="tab" onclick="showMiddlewareExample('custom-middleware')">ğŸ”§ Custom Middleware</button>
                <button class="tab" onclick="showMiddlewareExample('error-handling')">âš ï¸ Error Handling</button>
                <button class="tab" onclick="showMiddlewareExample('middleware-chain')">ğŸ”— Middleware Chain</button>
            </div>

            <!-- Express Basic Example -->
            <div id="express-basic" class="tab-content active">
                <div class="code-container">
                    <div class="code-block">
                        <div class="code-line comment">// ğŸš€ Express.js Middleware Basics</div>
                        <div class="code-line var-declaration">const express = require('express');</div>
                        <div class="code-line var-declaration">const app = express();</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// Middleware 1: Request Logger (Watchman)</div>
                        <div class="code-line var-usage">app.use((req, res, next) => {</div>
                        <div class="code-line var-usage">  console.log(`${new Date().toISOString()} - ${req.method} ${req.url}`);</div>
                        <div class="code-line var-usage">  console.log('ğŸ‘® Watchman: Kahan ja rahe ho?', req.url);</div>
                        <div class="code-line var-usage">  next(); // Aage bhejo</div>
                        <div class="code-line var-usage">});</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// Middleware 2: Authentication (Security Guard)</div>
                        <div class="code-line var-usage">app.use((req, res, next) => {</div>
                        <div class="code-line var-usage">  const token = req.headers.authorization;</div>
                        <div class="code-line var-usage">  if (!token) {</div>
                        <div class="code-line var-usage">    console.log('ğŸ” Security Guard: ID card dikhao!');</div>
                        <div class="code-line var-usage">    return res.status(401).json({ error: 'Token chahiye' });</div>
                        <div class="code-line var-usage">  }</div>
                        <div class="code-line var-usage">  console.log('ğŸ” Security Guard: ID check ho gaya, jao!');</div>
                        <div class="code-line var-usage">  next();</div>
                        <div class="code-line var-usage">});</div>
                    </div>
                    <div class="code-block">
                        <div class="code-line comment">// Main API Route (Aakhri Manzil)</div>
                        <div class="code-line var-declaration">app.get('/user/profile', (req, res) => {</div>
                        <div class="code-line var-usage">  console.log('ğŸšª API Handler: Request apni manzil tak pohunch gaya!');</div>
                        <div class="code-line var-usage">  res.json({</div>
                        <div class="code-line var-usage">    message: 'Welcome Babita Ji!',</div>
                        <div class="code-line var-usage">    user: { name: 'Babita', role: 'user' }</div>
                        <div class="code-line var-usage">  });</div>
                        <div class="code-line var-declaration">});</div>
                        <div class="code-line"></div>
                        <div class="code-line var-assignment">app.listen(3000, () => {</div>
                        <div class="code-line var-usage">  console.log('ğŸ¢ Society server port 3000 pe chal raha hai');</div>
                        <div class="code-line var-assignment">});</div>
                    </div>
                </div>
                <button class="demo-btn first-btn" onclick="testExpressBasic()">ğŸš€ Express Middleware Test Karo</button>
                <div id="expressBasicResult" class="result-panel" style="margin-top: 1rem;">
                    <div class="result-content">Express middleware test karne ke liye click karo...</div>
                </div>
            </div>

            <!-- Custom Middleware Example -->
            <div id="custom-middleware" class="tab-content">
                <div class="code-container">
                    <div class="code-block">
                        <div class="code-line comment">// ğŸ”§ Custom Middleware Functions</div>
                        <div class="code-line comment">// ğŸ‘® Watchman Middleware</div>
                        <div class="code-line var-declaration">function requestLogger(req, res, next) {</div>
                        <div class="code-line var-usage">  const timestamp = new Date().toISOString();</div>
                        <div class="code-line var-usage">  console.log(`[${timestamp}] ${req.method} ${req.url}`);</div>
                        <div class="code-line var-usage">  req.requestTime = timestamp; // Request mein data daal do</div>
                        <div class="code-line var-usage">  next(); // Aage bhejo</div>
                        <div class="code-line var-declaration">}</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// ğŸ” Security Guard Middleware</div>
                        <div class="code-line var-declaration">function authenticateToken(req, res, next) {</div>
                        <div class="code-line var-usage">  const authHeader = req.headers['authorization'];</div>
                        <div class="code-line var-usage">  const token = authHeader && authHeader.split(' ')[1];</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">  if (!token) {</div>
                        <div class="code-line var-usage">    return res.status(401).json({</div>
                        <div class="code-line var-usage">      error: 'Access band hai. Token chahiye.',</div>
                        <div class="code-line var-usage">      message: 'ğŸš« Security Guard: ID card nahi dikhaya!'</div>
                        <div class="code-line var-usage">    });</div>
                        <div class="code-line var-usage">  }</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">  // Token check karo (simple version)</div>
                        <div class="code-line var-usage">  if (token === 'valid-token') {</div>
                        <div class="code-line var-usage">    req.user = { id: 1, name: 'Babita', role: 'user' };</div>
                        <div class="code-line var-usage">    next();</div>
                        <div class="code-line var-usage">  } else {</div>
                        <div class="code-line var-usage">    return res.status(403).json({</div>
                        <div class="code-line var-usage">      error: 'Token galat hai',</div>
                        <div class="code-line var-usage">      message: 'ğŸš« Security Guard: Nakli ID card!'</div>
                        <div class="code-line var-usage">    });</div>
                        <div class="code-line var-usage">  }</div>
                        <div class="code-line var-declaration">}</div>
                    </div>
                    <div class="code-block">
                        <div class="code-line comment">// ğŸ“ Log Book Middleware</div>
                        <div class="code-line var-declaration">function logEntry(req, res, next) {</div>
                        <div class="code-line var-usage">  const entry = {</div>
                        <div class="code-line var-usage">    user: req.user?.name || 'Pata nahi',</div>
                        <div class="code-line var-usage">    action: `${req.method} ${req.url}`,</div>
                        <div class="code-line var-usage">    timestamp: req.requestTime,</div>
                        <div class="code-line var-usage">    ip: req.ip</div>
                        <div class="code-line var-usage">  };</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">  console.log('ğŸ“ Log Book Entry:', entry);</div>
                        <div class="code-line var-usage">  // Database mein save karna padega</div>
                        <div class="code-line var-usage">  // await logToDatabase(entry);</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">  next();</div>
                        <div class="code-line var-declaration">}</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// Usage: Middleware chain</div>
                        <div class="code-line var-usage">app.use(requestLogger);</div>
                        <div class="code-line var-usage">app.use(authenticateToken);</div>
                        <div class="code-line var-usage">app.use(logEntry);</div>
                    </div>
                </div>
                <button class="demo-btn first-btn" onclick="testCustomMiddleware()">ğŸ”§ Custom Middleware Test Karo</button>
                <div id="customMiddlewareResult" class="result-panel" style="margin-top: 1rem;">
                    <div class="result-content">Custom middleware test karne ke liye click karo...</div>
                </div>
            </div>

            <!-- Error Handling Example -->
            <div id="error-handling" class="tab-content">
                <div class="code-container">
                    <div class="code-block">
                        <div class="code-line comment">// âš ï¸ Error Handling Middleware</div>
                        <div class="code-line comment">// Global Error Handler (Aakhir mein)</div>
                        <div class="code-line var-declaration">function errorHandler(err, req, res, next) {</div>
                        <div class="code-line var-usage">  console.error('ğŸš¨ Error aaya:', err.message);</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">  // Error ke type ke hisaab se response</div>
                        <div class="code-line var-usage">  if (err.name === 'ValidationError') {</div>
                        <div class="code-line var-usage">    return res.status(400).json({</div>
                        <div class="code-line var-usage">      error: 'Validation fail hua',</div>
                        <div class="code-line var-usage">      message: 'ğŸ“ Log Book: Galat information di hai!'</div>
                        <div class="code-line var-usage">    });</div>
                        <div class="code-line var-usage">  }</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">  if (err.name === 'UnauthorizedError') {</div>
                        <div class="code-line var-usage">    return res.status(401).json({</div>
                        <div class="code-line var-usage">      error: 'Permission nahi hai',</div>
                        <div class="code-line var-usage">      message: 'ğŸ” Security Guard: Ijaazat nahi hai!'</div>
                        <div class="code-line var-usage">    });</div>
                        <div class="code-line var-usage">  }</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">  // General server error</div>
                        <div class="code-line var-usage">  res.status(500).json({</div>
                        <div class="code-line var-usage">    error: 'Server mein kharabi',</div>
                        <div class="code-line var-usage">    message: 'ğŸ¢ Society mein koi problem hai!'</div>
                        <div class="code-line var-usage">  });</div>
                        <div class="code-line var-declaration">}</div>
                    </div>
                    <div class="code-block">
                        <div class="code-line comment">// Async Error Wrapper</div>
                        <div class="code-line var-declaration">function asyncHandler(fn) {</div>
                        <div class="code-line var-usage">  return (req, res, next) => {</div>
                        <div class="code-line var-usage">    Promise.resolve(fn(req, res, next)).catch(next);</div>
                        <div class="code-line var-usage">  };</div>
                        <div class="code-line var-declaration">}</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// Routes mein use</div>
                        <div class="code-line var-usage">app.get('/user/profile', asyncHandler(async (req, res) => {</div>
                        <div class="code-line var-usage">  // Ye async function hai, errors apne aap handle honge</div>
                        <div class="code-line var-usage">  const user = await getUserFromDatabase(req.user.id);</div>
                        <div class="code-line var-usage">  if (!user) {</div>
                        <div class="code-line var-usage">    throw new Error('User nahi mila'); // Apne aap pakda jayega</div>
                        <div class="code-line var-usage">  }</div>
                        <div class="code-line var-usage">  res.json(user);</div>
                        <div class="code-line var-usage">}));</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// Error handler ko aakhir mein register karo</div>
                        <div class="code-line var-usage">app.use(errorHandler);</div>
                    </div>
                </div>
                <button class="demo-btn first-btn" onclick="testErrorHandling()">âš ï¸ Error Handling Test Karo</button>
                <div id="errorHandlingResult" class="result-panel" style="margin-top: 1rem;">
                    <div class="result-content">Error handling test karne ke liye click karo...</div>
                </div>
            </div>

            <!-- Middleware Chain Example -->
            <div id="middleware-chain" class="tab-content">
                <div class="code-container">
                    <div class="code-block">
                        <div class="code-line comment">// ğŸ”— Poora Middleware Chain Setup</div>
                        <div class="code-line var-declaration">const express = require('express');</div>
                        <div class="code-line var-declaration">const app = express();</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// 1ï¸âƒ£ Global Middlewares (Sab routes ke liye)</div>
                        <div class="code-line var-usage">app.use(express.json()); // JSON parser</div>
                        <div class="code-line var-usage">app.use(requestLogger); // Har request log karo</div>
                        <div class="code-line var-usage">app.use(corsHandler); // CORS headers daalo</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// 2ï¸âƒ£ Public Routes (Koi authentication nahi)</div>
                        <div class="code-line var-usage">app.get('/public/news', (req, res) => {</div>
                        <div class="code-line var-usage">  res.json({ news: 'Gokuldham Society mein nayi khabrein!' });</div>
                        <div class="code-line var-usage">});</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// 3ï¸âƒ£ Protected Routes (Authentication chahiye)</div>
                        <div class="code-line var-usage">app.use('/user', authenticateToken); // Sab /user routes protected</div>
                        <div class="code-line var-usage">app.get('/user/profile', logEntry, (req, res) => {</div>
                        <div class="code-line var-usage">  res.json({ user: req.user });</div>
                        <div class="code-line var-usage">});</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// 4ï¸âƒ£ Admin Routes (Role-based access)</div>
                        <div class="code-line var-usage">app.use('/admin', authenticateToken, requireAdmin);</div>
                        <div class="code-line var-usage">app.get('/admin/dashboard', logEntry, (req, res) => {</div>
                        <div class="code-line var-usage">  res.json({ message: 'Admin dashboard ka data' });</div>
                        <div class="code-line var-usage">});</div>
                    </div>
                    <div class="code-block">
                        <div class="code-line comment">// 5ï¸âƒ£ Route-specific Middleware</div>
                        <div class="code-line var-declaration">function requireAdmin(req, res, next) {</div>
                        <div class="code-line var-usage">  if (req.user.role !== 'admin') {</div>
                        <div class="code-line var-usage">    return res.status(403).json({</div>
                        <div class="code-line var-usage">      message: 'ğŸš« Sirf Secretary ko ijaazat hai!'</div>
                        <div class="code-line var-usage">    });</div>
                        <div class="code-line var-usage">  }</div>
                        <div class="code-line var-usage">  next();</div>
                        <div class="code-line var-declaration">}</div>
                        <div class="code-line"></div>
                        <div class="code-line comment">// 6ï¸âƒ£ Rate Limiting Middleware</div>
                        <div class="code-line var-declaration">function rateLimiter(maxRequests = 100) {</div>
                        <div class="code-line var-usage">  const requests = new Map();</div>
                        <div class="code-line var-usage">  return (req, res, next) => {</div>
                        <div class="code-line var-usage">    const clientIP = req.ip;</div>
                        <div class="code-line var-usage">    const now = Date.now();</div>
                        <div class="code-line var-usage">    const windowStart = now - (60 * 1000); // 1 minute ka window</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">    if (!requests.has(clientIP)) {</div>
                        <div class="code-line var-usage">      requests.set(clientIP, []);</div>
                        <div class="code-line var-usage">    }</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">    const userRequests = requests.get(clientIP);</div>
                        <div class="code-line var-usage">    const recentRequests = userRequests.filter(time => time > windowStart);</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">    if (recentRequests.length >= maxRequests) {</div>
                        <div class="code-line var-usage">      return res.status(429).json({</div>
                        <div class="code-line var-usage">        message: 'ğŸš« Bahut zyada requests! Thodi der wait karo!'</div>
                        <div class="code-line var-usage">      });</div>
                        <div class="code-line var-usage">    }</div>
                        <div class="code-line"></div>
                        <div class="code-line var-usage">    recentRequests.push(now);</div>
                        <div class="code-line var-usage">    requests.set(clientIP, recentRequests);</div>
                        <div class="code-line var-usage">    next();</div>
                        <div class="code-line var-usage">  };</div>
                        <div class="code-line var-declaration">}</div>
                    </div>
                </div>
                <button class="demo-btn first-btn" onclick="testMiddlewareChain()">ğŸ”— Middleware Chain Test Karo</button>
                <div id="middlewareChainResult" class="result-panel" style="margin-top: 1rem;">
                    <div class="result-content">Middleware chain test karne ke liye click karo...</div>
                </div>
            </div>
        </div>

        <!-- Middleware Benefits & Types -->
        <div class="comparison-section">
            <h3>ğŸ¯ Middleware ke Types aur Benefits</h3>
            
            <table class="comparison-table responsive-table">
                <thead>
                    <tr>
                        <th>Middleware Type</th>
                        <th>Kaam</th>
                        <th>Jethalal ki Misal</th>
                        <th>Asli Example</th>
                        <th>Kab Use Karna</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ğŸ” Authentication</strong></td>
                        <td>User ki pehchaan check karna</td>
                        <td>Security Guard ka ID check</td>
                        <td>JWT token check, session verification</td>
                        <td>Protected routes, user ka data</td>
                    </tr>
                    <tr>
                        <td><strong>ğŸ“ Logging</strong></td>
                        <td>Request/Response track karna</td>
                        <td>Log book mein entry likhna</td>
                        <td>Morgan, Winston, custom loggers</td>
                        <td>Debugging, analytics, audit ke liye</td>
                    </tr>
                    <tr>
                        <td><strong>ğŸ›¡ï¸ CORS</strong></td>
                        <td>Cross-origin requests handle karna</td>
                        <td>Bahari visitors ka permission check</td>
                        <td>cors npm package, custom headers</td>
                        <td>Frontend-backend alag domains pe</td>
                    </tr>
                    <tr>
                        <td><strong>âš ï¸ Error Handling</strong></td>
                        <td>Errors ko smoothly handle karna</td>
                        <td>Emergency response team</td>
                        <td>try-catch wrappers, error boundaries</td>
                        <td>Production apps, user experience</td>
                    </tr>
                    <tr>
                        <td><strong>ğŸ“Š Rate Limiting</strong></td>
                        <td>Requests ki frequency control karna</td>
                        <td>Society mein visitors ki limit</td>
                        <td>express-rate-limit, Redis-based</td>
                        <td>API misuse rokna, DDoS se bachao</td>
                    </tr>
                    <tr>
                        <td><strong>ğŸ”§ Body Parsing</strong></td>
                        <td>Request data ko parse karna</td>
                        <td>Courier package khol ke check karna</td>
                        <td>express.json(), multer for files</td>
                        <td>POST/PUT requests, file uploads</td>
                    </tr>
                    <tr>
                        <td><strong>ğŸ­ Compression</strong></td>
                        <td>Response ka size chhota karna</td>
                        <td>Suitcase mein kapde compress karna</td>
                        <td>compression npm package</td>
                        <td>Performance behtar karna, bandwidth bachana</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Middleware Best Practices -->
        <div class="comparison-section">
            <h3>ğŸ’¡ Middleware ke Best Practices</h3>
            
            <table class="comparison-table responsive-table">
                <thead>
                    <tr>
                        <th>Practice</th>
                        <th>âœ… Ye Karo</th>
                        <th>âŒ Ye Mat Karo</th>
                        <th>Kyun?</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Order Zaroori Hai</strong></td>
                        <td>Logical tarike se middleware lagao</td>
                        <td>Random order mein middleware daal dena</td>
                        <td>Request flow smooth rehna chahiye</td>
                    </tr>
                    <tr>
                        <td><strong>Hamesha next() Call Karo</strong></td>
                        <td>next() call karo ya response bhejo</td>
                        <td>next() bhool jana</td>
                        <td>Request ruk jayegi</td>
                    </tr>
                    <tr>
                        <td><strong>Error Handling</strong></td>
                        <td>try-catch use karo, next(error) call karo</td>
                        <td>Errors ko ignore karna</td>
                        <td>App crash ho sakti hai</td>
                    </tr>
                    <tr>
                        <td><strong>Reusability</strong></td>
                        <td>Generic middleware functions banao</td>
                        <td>Har route ke liye duplicate code</td>
                        <td>DRY principle, maintainability</td>
                    </tr>
                    <tr>
                        <td><strong>Performance</strong></td>
                        <td>Light-weight middleware, async/await</td>
                        <td>Middleware mein heavy kaam</td>
                        <td>Request response time pe asar</td>
                    </tr>
                    <tr>
                        <td><strong>Security</strong></td>
                        <td>Input validation, sanitization</td>
                        <td>Raw user input pe bharosa karna</td>
                        <td>Security risks</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Real-world Scenarios -->
        <div class="comparison-section">
            <h3>ğŸŒ Real-world Middleware Scenarios</h3>
            
            <table class="comparison-table responsive-table">
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Zaroori Middleware</th>
                        <th>Kaise Lagaya</th>
                        <th>Faayde</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ğŸ›’ E-commerce API</strong></td>
                        <td>Auth, Rate limiting, Logging, Validation</td>
                        <td>JWT check, Request/min limits</td>
                        <td>Surakshit shopping, misuse se bachao</td>
                    </tr>
                    <tr>
                        <td><strong>ğŸ“± Social Media App</strong></td>
                        <td>Auth, Image processing, Content moderation</td>
                        <td>Token check, Multer, AI filtering</td>
                        <td>User safety, content quality</td>
                    </tr>
                    <tr>
                        <td><strong>ğŸ¦ Banking System</strong></td>
                        <td>Strong auth, Encryption, Audit logs</td>
                        <td>2FA, SSL/TLS, Poora logging</td>
                        <td>Security rules follow, fraud detection</td>
                    </tr>
                    <tr>
                        <td><strong>ğŸ“° News Website</strong></td>
                        <td>Caching, Compression, Analytics</td>
                        <td>Redis cache, Gzip, User tracking</td>
                        <td>Tez loading, user insights</td>
                    </tr>
                    <tr>
                        <td><strong>ğŸ® Gaming API</strong></td>
                        <td>Real-time auth, Rate limiting, Analytics</td>
                        <td>WebSocket auth, Game-specific limits</td>
                        <td>Fair khel, performance dekho</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
    
        let isRequestInProgress = false;

        // Middleware flow demonstrations
        function demonstrateMiddlewareFlow() {
            const result = document.getElementById('middlewareResults');
            
            result.innerHTML = `
                <div class="success-message">
                    <strong>ğŸšª Poora Middleware Flow - Society Exit Process</strong><br><br>
                    <strong>Request:</strong> Babita ji bahar jana chahti hain<br><br>
                    <strong>Middleware Pipeline:</strong><br>
                    1ï¸âƒ£ <strong>Watchman (Logger):</strong> "Kahan ja rahi ho?" â†’ Logged: "Babita going out"<br>
                    2ï¸âƒ£ <strong>Security Guard (Auth):</strong> ID card check â†’ Verified: Valid resident<br>
                    3ï¸âƒ£ <strong>Log Book (Audit):</strong> Entry likhi â†’ Time: ${new Date().toLocaleTimeString()}<br>
                    4ï¸âƒ£ <strong>Rate Limit:</strong> Frequency check â†’ OK: Aaj zyada exits nahi<br>
                    5ï¸âƒ£ <strong>Aakhri Gate:</strong> Ijaazat mili â†’ Babita ji bahar gayi!<br><br>
                    <strong>Result:</strong><br>
                    âœ… Sab middleware pass hue<br>
                    âœ… Request successfully process hui<br>
                    âœ… Proper audit trail bana<br>
                    âœ… Security aur validation poori
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                </div>
            `;
        }

        function demonstrateMiddlewareReject() {
            const result = document.getElementById('middlewareResults');
            
            result.innerHTML = `
                <div class="error-message">
                    <strong>ğŸš« Middleware Rejection - Request Rok Di</strong><br><br>
                    <strong>Request:</strong> Koi ajnabi society mein ghusne ki koshish<br><br>
                    <strong>Middleware Pipeline:</strong><br>
                    1ï¸âƒ£ <strong>Watchman (Logger):</strong> "Kahan ja rahe ho?" â†’ Logged: "Unknown person"<br>
                    2ï¸âƒ£ <strong>Security Guard (Auth):</strong> ID card check â†’ âŒ <strong>REJECTED!</strong><br><br>
                    <strong>Error Response:</strong><br>
                    {<br>
                    &nbsp;&nbsp;"error": "Bina ijaazat entry nahi",<br>
                    &nbsp;&nbsp;"message": "ğŸš« Security Guard: Aapka ID card valid nahi hai!",<br>
                    &nbsp;&nbsp;"code": 401<br>
                    }<br><br>
                    <strong>Result:</strong><br>
                    âŒ Request Security Guard level pe ruki<br>
                    âŒ Log Book tak nahi pohunchi<br>
                    âŒ Main API handler kabhi call nahi hua<br>
                    âœ… System security maintain hui
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                </div>
            `;
        }

        function demonstrateMiddlewareReuse() {
            const result = document.getElementById('middlewareResults');
            
            result.innerHTML = `
                <div class="success-message">
                    <strong>â™»ï¸ Middleware Reusability - Ek Watchman, Kai Gates</strong><br><br>
                    <strong>Ek hi Auth Middleware ka Use:</strong><br><br>
                    ğŸšª <strong>/user/profile</strong><br>
                    â€¢ Watchman: "Profile dekhne ja rahe ho?"<br>
                    â€¢ Security: ID verified âœ…<br>
                    â€¢ Result: Entry mili<br><br>
                    ğŸšª <strong>/user/settings</strong><br>
                    â€¢ Watchman: "Settings badalne ja rahe ho?"<br>
                    â€¢ Security: Wahi ID, verified âœ…<br>
                    â€¢ Result: Entry mili<br><br>
                    ğŸšª <strong>/admin/dashboard</strong><br>
                    â€¢ Watchman: "Admin area mein ja rahe ho?"<br>
                    â€¢ Security: ID verified, par admin nahi âŒ<br>
                    â€¢ Result: Entry nahi mili<br><br>
                    <strong>Faayde:</strong><br>
                    âœ… Ek baar code likha, kai jagah use<br>
                    âœ… Sab APIs pe same security<br>
                    âœ… Aasan maintenance aur updates<br>
                    âœ… DRY principle follow hua
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                </div>
            `;
        }

        function clearMiddlewareDemo() {
            document.getElementById('middlewareResults').innerHTML = `
                <div class="event-message one-message">
                    Upar ke buttons dabao Middleware ka action dekhne ke liye!
                </div>
            `;
        }

        // API Request Simulation
        function sendAPIRequest() {
            if (isRequestInProgress) {
                alert('Request pehle se chal rahi hai! Thodi der wait karo...');
                return;
            }

            isRequestInProgress = true;
            const btn = document.getElementById('sendRequestBtn');
            btn.disabled = true;
            btn.textContent = 'â³ Request Process Ho Rahi Hai...';

            const endpoint = document.getElementById('apiEndpoint').value;
            const token = document.getElementById('authToken').value;
            const role = document.getElementById('userRole').value;

            // Reset pipeline visualization
            resetPipelineVisualization();

            // Start pipeline execution
            executePipeline(endpoint, token, role).then(() => {
                isRequestInProgress = false;
                btn.disabled = false;
                btn.textContent = 'ğŸš€ API Request Bhejo';
            });
        }

        function resetPipelineVisualization() {
            const steps = ['step1-logger', 'step2-auth', 'step3-role', 'step4-rate', 'step5-api', 'step6-response'];
            steps.forEach(step => {
                const element = document.getElementById(step);
                element.className = 'memory-slot';
                element.querySelector('.variable-value').textContent = 'Intezaar...';
            });
            document.getElementById('executionLog').innerHTML = 'Middleware execution track karne ke liye tayyar...';
        }

        async function executePipeline(endpoint, token, role) {
            const log = document.getElementById('executionLog');
            let logContent = '';

            // Step 1: Request Logger
            await delay(500);
            updateStep('step1-logger', 'processing', `Logging: ${endpoint}`);
            logContent += `<strong style="color: #356c67;">ğŸ‘® Watchman:</strong> "${endpoint}" request aayi hai<br>`;
            log.innerHTML = logContent;

            // Step 2: Authentication
            await delay(700);
            if (!token) {
                updateStep('step2-auth', 'error', 'Koi token nahi diya');
                logContent += `<strong style="color: #f56565;">ğŸ” Security Guard:</strong> Token nahi diya! Request reject hui.<br>`;
                log.innerHTML = logContent;
                return;
            } else if (token === 'expired-token') {
                updateStep('step2-auth', 'error', 'Token ka time khatam');
                logContent += `<strong style="color: #f56565;">ğŸ” Security Guard:</strong> Token expire ho gaya! Request reject hui.<br>`;
                log.innerHTML = logContent;
                return;
            } else {
                updateStep('step2-auth', 'success', 'Token check ho gaya');
                logContent += `<strong style="color: #4caf50;">ğŸ” Security Guard:</strong> Token valid hai, aage jao!<br>`;
                log.innerHTML = logContent;
            }

            // Step 3: Role Authorization
            await delay(600);
            if (endpoint.includes('/admin') && role !== 'admin') {
                updateStep('step3-role', 'error', 'Permission nahi hai');
                logContent += `<strong style="color: #f56565;">ğŸ‘¨â€ğŸ’¼ Role Checker:</strong> Admin area mein jaane ka haq nahi hai!<br>`;
                log.innerHTML = logContent;
                return;
            } else {
                updateStep('step3-role', 'success', `Role: ${role} ko ijaazat hai`);
                logContent += `<strong style="color: #4caf50;">ğŸ‘¨â€ğŸš€ Role Checker:</strong> ${role} role ko ijaazat hai!<br>`;
                log.innerHTML = logContent;
            }

            // Step 4: Rate Limiting
            await delay(400);
            updateStep('step4-rate', 'success', 'Rate limit theek hai');
            logContent += `<strong style="color: #4caf50;">â±ï¸ Rate Limiter:</strong> Request speed normal hai!<br>`;
            log.innerHTML = logContent;

            // Step 5: API Handler
            await delay(600);
            updateStep('step5-api', 'success', 'Business logic chal gaya');
            logContent += `<strong style="color: #4caf50;">ğŸ¯ API Handler:</strong> Business logic ka kaam ho gaya!<br>`;
            log.innerHTML = logContent;

            // Step 6: Response
            await delay(500);
            updateStep('step6-response', 'success', 'Jawab bhej diya');
            logContent += `<strong style="color: #4caf50;">ğŸ“¤ Response:</strong> Success jawab bhej diya gaya!<br>`;
            log.innerHTML = logContent;
        }

        function updateStep(stepId, status, message) {
            const element = document.getElementById(stepId);
            element.className = `memory-slot ${status === 'error' ? 'ğŸš«' : status === 'success' ? '' : 'hoisted'}`;
            element.querySelector('.variable-value').innerHTML = message;
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Code example test functions
        function testExpressBasic() {
            document.getElementById('expressBasicResult').innerHTML = `
                <div class="success-message">
                    <strong>ğŸš–ï¸ Express Middleware Test Results:</strong><br><br>
                    <div style="background: #2d3748; color: #e2e8f0; padding: 1rem; border-radius: 8px; margin: 0.5rem 0; font-family: monospace;">
                        [2024-01-15T14:00:00.000Z] GET /user/profile<br>
                        ğŸ‘® Watchman: Kahan ja rahe ho? /user/profile<br>
                        ğŸ” Security Guard: ID check ho gaya, jao!<br>
                        ğŸšª API Handler: Request apni manzil tak pohunch gaya!<br>
                        Response: {"message":"Welcome Babita Ji!","user":"{name":"Babita","role":"user":"}}
                    </div>
                    <strong>Pipeline Success:</strong><br>
                    âœ… Request theek se log hua<br>
                    âœ… Authentication pass hua<br>
                    âœ… API jawab banaya gaya<br>
                    âœ… Client ko data mil gaya
                </div>
            `;
        }

        function testCustomMiddleware() {
            document.getElementByIdcustomMiddleware('Result').innerHTML = `
                <div class="success-message">
                    <strong>ğŸ”§ Custom Middleware Test Results:</strong><br><br>
                    <div style="background: #2d3748; color: #e2e8f0; padding: 1rem; border-radius: 8px; margin: 0.5rem 0; font-family: monospace;">
                        [2024-01-15T14:00:00.000Z] POST /user/update<br>
                        ğŸ‘® Request Logger: Request mein time daala gaya<br>
                        ğŸ” Authentication: Babita ji ka token check hua<br>
                        ğŸ“ Log Entry: {user: "Babita", action: "POST /user/update", timestamp: "2024-01-15T14:00:00.000Z", ip: "127.0.0.1"}<br>
                        ğŸ¯ API Handler: User profile update success hua
                    </div>
                    <strong>Custom Middleware ke Faayde:</strong><br>
                    âœ… Reusable functions banaye<br>
                    âœ… Request mein data add hua<br>
                    âœ… Proper audit trail bana<br>
                    âœ… Kaam ka clear division
                </div>
            `;
        }

        function testErrorHandling() {
            document.getElementById('errorHandlingResult').innerHTML = `
                <div class="error-message">
                    <strong>âš ï¸ Error Handling Test Results:</strong><br><br>
                    <div style="background: #2d3748; color: #e2e8f0; padding: 1rem; border-radius: 8px; margin: 0.5rem 0; font-family: monospace;">
                        [2024-01-15T14:00:00.000Z] GET /user/profile<br>
                        ğŸ‘® Request Logger: Request log hua<br>
                        ğŸ” Authentication: Auth pass hua<br>
                        ğŸ¯ API Handler: Database connection fail hua!<br>
                        ğŸš¨ Error Handler: Server error pakda gaya<br>
                        ğŸ“¤ Response: {"error":"Server mein kharabi","message":"ğŸ¢ Society mein koi problem hai!"}
                    </div>
                    <strong>Error Handling Success:</strong><br>
                    âœ… Error ko smoothly pakda gaya<br>
                    âœ… User ko friendly message mila<br>
                    âœ… App crash nahi hui<br>
                    âœ… Error debugging ke liye log hua
                </div>
            `;
        }

        function testMiddlewareChain() {
            document.getElementById('middlewareChainResult').innerHTML = `
                <div class="success-message">
                    <strong>ğŸ”— Middleware Chain Test Results:</strong><br><br>
                    <strong>Route: /admin/dashboard</strong><br>
                    <div style="background: #2d3748; color: #e2e8f0; padding: 1rem; border-radius: 8px; margin: 0.5rem 0; font-family: monospace;">
                        <1ï¸âƒ£ JSON Parser: Request body parse hua<br>
                        <2ï¸âƒ£ Request Logger: Admin dashboard access log hua<br>
                        <3ï¸âƒ£ CORS Handler: Headers daale gaye<br>
                        <4ï¸âƒ£ Auth Middleware: Token check hua<br>
                        <5ï¸âƒ£ Admin Check: Admin role verified hua<br>
                        <6ï¸âƒ£ Log Entry: Access record hua<br>
                        <7ï¸âƒ£ Rate Limiter: Request allowed hai<br>
                        <8ï¸âƒ£ API Handler: Dashboard data bheja gaya
                    </div>
                    <strong>Poora Chain Success:</strong><br>
                    âœ… 8 middleware sahi order mein chale<br>
                    âœ… Security, logging, validation poori hui<br>
                    âœ… Admin access sahi se control hua<br>
                    âœ… Response optimize hua
                </div>
            `;
        }

        // Show code examples
        function showMiddlewareExample(example) {
            // Sab tab contents hide karo
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Sab tabs se active class hatao
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Chuna hua tab content dikhao
            document.getElementById(example).classList.add('active');
            
            // Clicked tab ko active class do
            event.target.classList.add('active');
        }

        // Demo initialize karo
        window.onload = function() {
            clearMiddlewareDemo();
            resetPipelineVisualization();
        };
    </script>
</body>
</html>