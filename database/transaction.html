<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Transactions ka Funda- Fullstackgada Interactive Demo</title>
    <link rel="icon" type="image/png" href="/image/favicon.ico">
    <link rel="stylesheet" href="/interactive-demo.css">
</head>
<body>
<div class="container">
    <!-- Header -->
    <div class="header-interactive" style="position:relative;">
        <h1>SQL Transactions ka Funda</h1>
        <p>Understand how SQL Transactions works with Fullstackgada</p>
       <div class="explore-diagrams-btn-wrapper">
            <a href="/interactive.html" class="explore-diagrams-btn">
                <img src="/image/plus-circle.svg" alt="Instagram icon"> More Diagrams
            </a>
        </div>
       <div class="follow-btn-wrapper">
            <a href="https://www.instagram.com/fullstackgada" target="_blank" class="follow-btn">
    <img src="/image/instagram.svg" alt="Instagram icon"> Follow for More
</a>
        </div>
    </div>

    <!-- Demo Grid -->
    <div class="demo-grid">
        <!-- Transaction Concepts -->
        <div class="demo-section">
            <h2 class="demo-title">üîÑ SQL Transactions Explorer</h2>
            <div class="explanation">
                <b>Transactions:</b> Sab kuch ek saath ya phir bilkul nahi! Stock ghatana, order daalna, payment ‚Äî ya toh sab ho ya ek bhi nahi.
            </div>
            <div class="demo-controls">
                <button class="demo-btn first-btn" onclick="startTransaction(true)">
                    ‚úÖ Successful Transaction
                </button>
                <button class="demo-btn" onclick="startTransaction(false)">
                    ‚ùå Transaction mein Error (Rollback)
                </button>
                <button class="demo-btn clear-btn" onclick="clearTransDemo()">
                    üîÑ Demo Reset Karo
                </button>
            </div>
            <!-- Visual Transaction Steps -->
            <div class="memory-diagram" id="transSteps">
                <div class="memory-slot" id="step1">
                    <b>BEGIN</b> <br> (Transaction shuru)
                </div>
                <div class="memory-slot" id="step2">
                    <b>Stock -1</b> <br> (Stock kam kiya)
                </div>
                <div class="memory-slot" id="step3">
                    <b>Order Added</b> <br> (Order daala)
                </div>
                <div class="memory-slot" id="step4">
                    <b>Payment</b> <br> (Payment hua)
                </div>
                <div class="memory-slot tdz" id="step5">
                    <b>Commit ya Rollback?</b>
                </div>
            </div>
            <!-- Transaction Output -->
            <div class="demo-area" id="transOutput">
                <div class="event-message one-message">
                    <b>Demo:</b> Upar ke button dabao aur dekho transaction kaise kaam karta hai!
                </div>
            </div>
        </div>

        <!-- Analogy Section -->
        <div class="demo-section">
            <h2 class="demo-title">üè† Gokuldham ka Analogy</h2>
            <div class="saree-analogy">
                <h4>Transaction = Shaadi ka Mandap!</h4>
                <div class="saree-step">
                    <div class="saree-emoji">ü™î</div>
                    <div>Teen rasmein chal rahi hain: <b>Haldi, Phere, Mangalsutra</b>... Ek bhi chhuti toh shaadi cancel (Rollback)!</div>
                </div>
                <div class="saree-step">
                    <div class="saree-emoji">üéâ</div>
                    <div>Sab rasmein poori? <b>Commit</b> ‚Äì Shaadi pakki!</div>
                </div>
                <div class="saree-step">
                    <div class="saree-emoji">üò®</div>
                    <div>Beech mein bijli chali gayi? ‚Äì Rollback ‚Äì Sab wapas, jaise kuch hua hi nahi.</div>
                </div>
            </div>
            <div class="how-it-works">
                <h4>üí° Transaction ke Properties (ACID)</h4>
                <div class="step"><div class="step-number">A</div>Atomicity: Sab ya kuch bhi nahi</div>
                <div class="step"><div class="step-number">C</div>Consistency: Data hamesha sahi rules pe</div>
                <div class="step"><div class="step-number">I</div>Isolation: Ek transaction doosre se alag</div>
                <div class="step"><div class="step-number">D</div>Durability: Ek baar commit hua ‚Äì data safe</div>
            </div>
        </div>
    </div>

    <!-- Transactional Tables and SQL -->
    <div class="demo-section">
        <h2 class="demo-title">üî¢ Example: Orders aur Stock Table</h2>
        <div class="tabs">
            <button class="tab active" onclick="showTab('orders-tab')">Orders</button>
            <button class="tab" onclick="showTab('stock-tab')">Stock</button>
            <button class="tab" onclick="showTab('sql-tab')">SQL Transaction</button>
        </div>
        <div id="orders-tab" class="tab-content active">
            <h4>üõí Orders Table</h4>
            <table class="responsive-table">
                <thead>
                    <tr>
                        <th>OrderID</th>
                        <th>Product</th>
                        <th>Qty</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="ordersRows">
                </tbody>
            </table>
        </div>
        <div id="stock-tab" class="tab-content">
            <h4>üì¶ Stock Table</h4>
            <table class="responsive-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>StockLeft</th>
                    </tr>
                </thead>
                <tbody id="stockRows">
                </tbody>
            </table>
        </div>
        <div id="sql-tab" class="tab-content">
            <h4>üíª Transaction SQL ka Example</h4>
            <div class="code-block" id="sqlDemo">
<pre>
BEGIN;
/* Step 1: Stock kam karo */
UPDATE Stock SET count = count - 1 WHERE product='Soap';

/* Step 2: Order daalo */
INSERT INTO Orders(product, qty, status) VALUES ('Soap', 1, 'Pending');

/* Step 3: Payment */
-- Yahan payment step imagine karo

/* Sab theek hai */
COMMIT;

/* Agar koi ERROR */
ROLLBACK;
</pre>
            </div>
            <div class="explanation">
                <b>Sirf COMMIT ke baad data pakka!</b> Error hua toh sab wapas (ROLLBACK).
            </div>
        </div>
    </div>
</div>

<script>
/** "Database" data for Orders/Stock demo **/
let stockTable = [{product:"Soap", count:5}, {product:"Shampoo", count:3}];
let ordersTable = [
    {orderid: 1, product: "Soap", qty: 1, status:"Delivered" }, 
    {orderid: 2, product: "Shampoo", qty: 1, status:"Delivered" }
];

function renderTables() {
    // Orders
    let orderHtml = '';
    ordersTable.forEach(o=>{
        orderHtml += `<tr>
            <td>${o.orderid}</td>
            <td>${o.product}</td>
            <td>${o.qty}</td>
            <td>${o.status}</td>
        </tr>`;
    });
    document.getElementById("ordersRows").innerHTML = orderHtml || "<tr><td colspan='4'>Koi Orders Nahi</td></tr>";
    // Stock
    let stockHtml = '';
    stockTable.forEach(s=>{
        stockHtml += `<tr>
            <td>${s.product}</td>
            <td>${s.count}</td>
        </tr>`;
    });
    document.getElementById("stockRows").innerHTML = stockHtml;
}
renderTables();

/** Transaction Simulation **/
function startTransaction(success) {
    // Reset visuals
    document.querySelectorAll('.memory-slot').forEach(e=>e.classList.remove('error','hoisted','tdz'));
    // Step 1: Begin
    document.getElementById('step1').classList.add('hoisted');
    document.getElementById('transOutput').innerHTML = "<div class='event-message one-message'>Transaction shuru...<br>BEGIN;</div>";

    setTimeout(()=>{
        // Step 2: Stock minus
        document.getElementById('step2').classList.add('hoisted');
        stockTable[0].count--;
        renderTables();
        document.getElementById('transOutput').innerHTML += "<div class='event-message one-message'>Stock kam kiya!</div>";
        
        setTimeout(()=>{
            // Step 3: Order insert
            document.getElementById('step3').classList.add('hoisted');
            let nextId = ordersTable.length ? Math.max(...ordersTable.map(o=>o.orderid))+1 : 1;
            ordersTable.push({orderid: nextId, product:"Soap", qty:1, status:"Pending"});
            renderTables();
            document.getElementById('transOutput').innerHTML += "<div class='event-message one-message'>Order daala!</div>";
            
            setTimeout(()=>{
                // Step 4: Payment
                document.getElementById('step4').classList.add('hoisted');
                document.getElementById('transOutput').innerHTML += "<div class='event-message one-message'>Payment processing...</div>";
                
                setTimeout(()=>{
                    // Step 5: Final
                    document.getElementById('step5').classList.remove('tdz');
                    if(success){
                        document.getElementById('step5').classList.add('hoisted');
                        ordersTable[ordersTable.length-1].status="Delivered";
                        renderTables();
                        document.getElementById('transOutput').innerHTML += "<div class='event-message one-message'><b>COMMIT; Sab kaam success ‚Äî Data pakka!</b></div>";
                    } else {
                        document.getElementById('step5').classList.add('error');
                        // ROLLBACK: revert stock, remove order
                        stockTable[0].count++;
                        ordersTable.pop();
                        renderTables();
                        document.getElementById('transOutput').innerHTML += "<div class='event-message two-message'><b>ERROR! System crash ‚Äî ROLLBACK; <br>Sab wapas, jaise kuch hua hi nahi.</b></div>";
                    }
                },700);
            },700);
        },700);
    },600);
}

/* Reset Transaction Demo */
function clearTransDemo(){
    // Reset data
    stockTable = [{product:"Soap", count:5}, {product:"Shampoo", count:3}];
    ordersTable = [
        {orderid: 1, product: "Soap", qty: 1, status:"Delivered" }, 
        {orderid: 2, product: "Shampoo", qty: 1, status:"Delivered" }
    ];
    renderTables();
    // Reset visuals
    document.querySelectorAll('.memory-slot').forEach(e=>e.classList.remove('error','hoisted','tdz'));
    document.getElementById('step5').classList.add('tdz');
    document.getElementById('transOutput').innerHTML = "<div class='event-message one-message'><b>Demo:</b> Upar ke button dabao aur dekho transaction kaise kaam karta hai!</div>";
}

/* Tabs */
function showTab(tabName) {
    let tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(t=>t.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
    let tabBtns = document.querySelectorAll('.tab');
    tabBtns.forEach(t=>t.classList.remove('active'));
    event.target.classList.add('active');
}
</script>
</body>
</html>